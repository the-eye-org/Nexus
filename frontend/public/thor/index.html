<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thor — Bifrost Redirect Loop</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');

    :root {
      --storm-bg: #0a0e14;
      --storm-dark: #050810;
      --storm-blue: #0d1520;
      --storm-grey: #1a2332;
      --lightning-cyan: #00d4ff;
      --lightning-dim: #0088aa;
      --stone: #2d3a4a;
      --stone-light: #3d4d5e;
      --text-muted: #6b7a8a;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Crimson Text', Georgia, serif;
      background: var(--storm-bg);
      color: #c8d4e0;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Rain effect */
    .rain-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    .rain {
      position: absolute;
      width: 2px;
      height: 80px;
      background: linear-gradient(transparent, rgba(100, 180, 255, 0.15));
      animation: rain-fall 1.2s linear infinite;
    }

    @keyframes rain-fall {
      to {
        transform: translateY(100vh) rotate(5deg);
      }
    }

    /* Lightning flash overlay */
    .lightning-flash {
      position: fixed;
      inset: 0;
      background: rgba(200, 230, 255, 0.4);
      opacity: 0;
      pointer-events: none;
      z-index: 100;
      transition: opacity 0.05s;
    }

    .lightning-flash.active {
      opacity: 1;
      animation: flash 0.15s ease-out;
    }

    @keyframes flash {
      0% {
        opacity: 1;
      }

      100% {
        opacity: 0;
      }
    }

    .content {
      position: relative;
      z-index: 1;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem 3rem;
    }

    /* Title section */
    .title-section {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .title-section h1 {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.4rem, 4vw, 2rem);
      font-weight: 700;
      color: #e8f0f8;
      text-shadow:
        0 0 20px rgba(0, 212, 255, 0.4),
        0 0 40px rgba(0, 136, 170, 0.2);
      letter-spacing: 0.08em;
      position: relative;
    }

    .title-section h1::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--lightning-cyan), transparent);
      opacity: 0.6;
    }

    /* Main puzzle area */
    .puzzle-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
    }

    .rune-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      max-width: 320px;
    }

    .rune-stone {
      aspect-ratio: 1;
      background: linear-gradient(145deg, var(--stone-light) 0%, var(--stone) 50%, #1e2836 100%);
      border: 2px solid var(--storm-grey);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Cinzel', serif;
      font-size: 2rem;
      color: rgba(0, 212, 255, 0.7);
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow:
        inset 0 2px 4px rgba(255, 255, 255, 0.08),
        0 4px 12px rgba(0, 0, 0, 0.4);
    }

    .rune-stone:hover {
      outline: 2px solid var(--lightning-cyan);
      outline-offset: 2px;
      box-shadow:
        0 0 15px rgba(0, 212, 255, 0.3),
        inset 0 2px 4px rgba(255, 255, 255, 0.08);
      transform: scale(1.03);
    }

    /* Rune symbols - Elder Futhark inspired */
    .rune-stone[data-rune="1"]::before {
      content: 'ᚠ';
    }

    .rune-stone[data-rune="2"]::before {
      content: 'ᚢ';
    }

    .rune-stone[data-rune="3"]::before {
      content: 'ᚦ';
    }

    .rune-stone[data-rune="4"]::before {
      content: 'ᚨ';
    }

    .rune-stone[data-rune="5"]::before {
      content: 'ᚱ';
    }

    .rune-stone[data-rune="6"]::before {
      content: 'ᚲ';
    }

    .rune-stone[data-rune="7"]::before {
      content: 'ᚷ';
    }

    .rune-stone[data-rune="8"]::before {
      content: 'ᚹ';
    }

    .rune-stone[data-rune="9"]::before {
      content: 'ᚺ';
    }

    .rune-stone.locked {
      outline: 2px solid var(--lightning-cyan);
      outline-offset: 2px;
      box-shadow:
        0 0 15px rgba(0, 212, 255, 0.5),
        inset 0 2px 4px rgba(255, 255, 255, 0.2);
      border-color: var(--lightning-cyan);
      color: var(--lightning-cyan);
      text-shadow: 0 0 8px var(--lightning-cyan);
      transform: scale(1.03);
    }



    .hint-text {
      font-size: 0.9rem;
      font-style: italic;
      color: var(--text-muted);
      margin-top: 0.5rem;
    }



    /* Lore / hidden clue - CSS text-shadow trick */
    .lore-section {
      margin-top: 3rem;
      max-width: 560px;
      padding: 0 1rem;
    }

    .lore-text {
      font-size: 0.95rem;
      line-height: 1.7;
      color: var(--text-muted);
      text-align: center;
    }


    .clue-placeholder {
      font-style: italic;
      color: var(--text-muted);
      opacity: 0.6;
    }

    .clue-container {
      margin-top: 1rem;
      min-height: 1.5rem;
      text-align: center;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .clue-container.revealed {
      opacity: 1;
    }

    .clue-reveal {
      color: var(--lightning-cyan);
      text-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
      font-family: 'Cinzel', serif;
      font-size: 1.1rem;
      letter-spacing: 0.05em;
    }

    .low-contrast-phrase {
      color: var(--text-muted);
      opacity: 0.3;
      transition: opacity 0.3s;
    }

    /* Screen shake on success */
    .content.shake {
      animation: screen-shake 0.5s ease;
    }

    @keyframes screen-shake {

      0%,
      100% {
        transform: translateX(0);
      }

      10% {
        transform: translateX(-4px) translateY(-2px);
      }

      20% {
        transform: translateX(4px) translateY(2px);
      }

      30% {
        transform: translateX(-3px) translateY(1px);
      }

      40% {
        transform: translateX(3px) translateY(-1px);
      }

      50% {
        transform: translateX(-2px) translateY(2px);
      }

      60% {
        transform: translateX(2px) translateY(-2px);
      }

      70% {
        transform: translateX(-1px);
      }

      80% {
        transform: translateX(1px);
      }

      90% {
        transform: translateX(-1px);
      }
    }

    /* Hide rune grid when Bifrost revealed */
    .rune-section.hidden {
      display: none;
    }

    .storm-calm .rain {
      opacity: 0.3;
    }

    @media (max-width: 480px) {
      .rune-grid {
        gap: 0.75rem;
        max-width: 280px;
      }

      .rune-stone {
        font-size: 1.6rem;
      }
    }
  </style>
</head>

<body>
  <div class="rain-container" id="rainContainer"></div>
  <div class="lightning-flash" id="lightningFlash"></div>

  <div class="content" id="mainContent">
    <header class="title-section">
      <h1>"Only the worthy may command the Bifrost."</h1>
    </header>

    <main class="puzzle-area">
      <section class="rune-section" id="runeSection">
        <div class="rune-grid" id="runeGrid">
          <div class="rune-stone" data-rune="1" tabindex="0"></div>
          <div class="rune-stone" data-rune="2" tabindex="0"></div>
          <div class="rune-stone" data-rune="3" tabindex="0"></div>
          <div class="rune-stone" data-rune="4" tabindex="0"></div>
          <div class="rune-stone" data-rune="5" tabindex="0"></div>
          <div class="rune-stone" data-rune="6" tabindex="0"></div>
          <div class="rune-stone" data-rune="7" tabindex="0"></div>
          <div class="rune-stone" data-rune="8" tabindex="0"></div>
          <div class="rune-stone" data-rune="9" tabindex="0"></div>
        </div>
      </section>

      <section class="success-message" id="successMessage" style="display: none; text-align: center; margin-top: 2rem;">
        <h2 style="font-family: 'Cinzel', serif; color: var(--lightning-cyan);">The Path is Open</h2>
        <p style="color: #c8d4e0; margin-top: 1rem;">You have proven your worth.</p>
      </section>
    </main>

    <footer class="lore-section" id="loreSection">
      <p class="lore-text">
        In the age of the All-Father, the Bifrost bridge connected the Nine Realms. Only those who proved their worth
        could pass.
        The runes held the key—each stone a gateway, each sequence a trial.
        <span class="low-contrast-phrase">— seek the light within the words you pass over —</span>
        Many sought passage; few understood the ancient ways.
      </p>
      <div id="clueContainer" class="clue-container">
        <span class="clue-reveal" id="clueText"></span>
      </div>
    </footer>
  </div>

  <script>
    (function () {
      const CORRECT_SEQUENCE = [4, 1, 8, 3];

      document.addEventListener('contextmenu', e => e.preventDefault());
      document.addEventListener('keydown', function (e) {
        if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key)) || (e.ctrlKey && e.key === 'u')) {
          e.preventDefault();
        }
      });

      const runeGrid = document.getElementById('runeGrid');
      const runeSection = document.getElementById('runeSection');
      const successMessage = document.getElementById('successMessage');
      const lightningFlash = document.getElementById('lightningFlash');
      const mainContent = document.getElementById('mainContent');
      const rainContainer = document.getElementById('rainContainer');

      let sequenceIndex = 0;

      function createRain() {
        const count = 50;
        for (let i = 0; i < count; i++) {
          const drop = document.createElement('div');
          drop.className = 'rain';
          drop.style.left = Math.random() * 100 + '%';
          drop.style.animationDelay = Math.random() * 1.2 + 's';
          drop.style.opacity = 0.3 + Math.random() * 0.4;
          rainContainer.appendChild(drop);
        }
      }
      createRain();

      function triggerLightning() {
        lightningFlash.classList.add('active');
        setTimeout(() => lightningFlash.classList.remove('active'), 150);
      }

      function redirectToStruck() {
        triggerLightning();
        setTimeout(() => {
          window.location.href = 'struck.html';
        }, 200);
      }

      function onWrongRune() {
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.frequency.value = 80;
          osc.type = 'sawtooth';
          gain.gain.setValueAtTime(0.15, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
          osc.start(ctx.currentTime);
          osc.stop(ctx.currentTime + 0.3);
        } catch (_) { }
        redirectToStruck();
      }

      function onSuccess() {
        mainContent.classList.add('shake');
        document.body.classList.add('storm-calm');
        setTimeout(() => {
          runeSection.classList.add('hidden');
          successMessage.style.display = 'block';
          mainContent.classList.remove('shake');

          // Redirect to Bridge after a brief pause
          setTimeout(() => {
            window.location.href = 'bridge.html';
          }, 2000);
        }, 600);
      }

      function handleRuneClick(runeNum, element) {
        const expected = CORRECT_SEQUENCE[sequenceIndex];
        if (runeNum === expected) {
          element.classList.add('locked'); // Lock this one
          sequenceIndex++;
          if (sequenceIndex === CORRECT_SEQUENCE.length) {
            onSuccess();
          }
        } else {
          sequenceIndex = 0;
          document.querySelectorAll('.rune-stone').forEach(el => el.classList.remove('locked'));
          onWrongRune();
        }
      }

      runeGrid.addEventListener('click', (e) => {
        const stone = e.target.closest('.rune-stone');
        if (!stone) return;
        const runeNum = parseInt(stone.dataset.rune, 10);
        handleRuneClick(runeNum, stone);
      });

      runeGrid.addEventListener('keydown', (e) => {
        if (e.key !== 'Enter' && e.key !== ' ') return;
        const stone = document.activeElement;
        if (!stone || !stone.classList.contains('rune-stone')) return;
        e.preventDefault();
        const runeNum = parseInt(stone.dataset.rune, 10);
        handleRuneClick(runeNum, stone);
      });



      const loreParagraph = document.querySelector('.lore-text');
      const clueContainer = document.getElementById('clueContainer');
      const clueText = document.getElementById('clueText');
      const clueChars = [80, 97, 116, 104, 32, 8594, 32, 52, 49, 56, 51];

      document.addEventListener('selectionchange', () => {
        const selection = window.getSelection();
        const selectedText = selection.toString().replace(/\s+/g, ' ').trim();
        const paragraphText = loreParagraph.textContent.replace(/\s+/g, ' ').trim();

        if (selectedText.length > 0 && paragraphText.includes(selectedText) && selectedText.length >= paragraphText.length * 0.95) {
          if (!clueText.textContent) {
            clueText.textContent = String.fromCharCode.apply(null, clueChars);
          }
          clueContainer.classList.add('revealed');
        }
      });
    })();
  </script>
</body>

</html>